[tools]
"github:sqlc-dev/sqlc" = "1.30.0"
java = "17"
shellcheck = "0.10.0"
shfmt = "3.10.0"

[tasks."codegen:sqlc"]
description = "Run SQLC code generation"
run = """
sqlc generate
rm -f app/src/main/java/Queries.java
if [ -f "app/src/main/java/com/biglucas/agena/db/Queries.java" ]; then
    sed -i 's/results.getObject(2, OffsetDateTime.class)/((com.biglucas.agena.db.wrapper.AndroidResultSet)results).getObject(2, OffsetDateTime.class)/g' app/src/main/java/com/biglucas/agena/db/Queries.java
fi
"""

[tasks.codegen]
description = "Run all codegen tasks"
depends = ["codegen:sqlc"]

[tasks."lint:android"]
description = "Run Android Lint"
run = "./gradlew lint"

[tasks."lint:shell"]
description = "Run ShellCheck"
run = "shellcheck make_release"

[tasks.lint]
description = "Run all linters"
depends = ["lint:*"]

[tasks."fmt:shell"]
description = "Run shfmt"
run = "shfmt -w make_release"

[tasks.fmt]
description = "Run all formatters"
depends = ["fmt:*"]

[tasks.install]
description = "Install dependencies"
run = "./gradlew dependencies"

[tasks.test]
description = "Run tests"
run = "./gradlew test"

[tasks."build:debug"]
description = "Build debug APK"
run = "./gradlew assembleDebug"

[tasks."build:release"]
description = "Build release APK"
run = "./gradlew assembleRelease"

[tasks.ci]
description = "Run CI tasks"
depends = ["lint", "test", "build:debug"]
